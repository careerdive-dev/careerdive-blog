<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading...</title>
    <!-- Open Graph meta tags - will be updated by script -->
    <meta property="og:title" content="Loading..." />
    <meta property="og:description" content="" />
    <meta property="og:image" content="" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4VY4NFKS38"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4VY4NFKS38');
    </script>

    <script>
      // Synchronously fetch and set meta tags for social media crawlers
      (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get("slug");
        if (!slug) return;

        // Use synchronous XMLHttpRequest for immediate execution
        const xhr = new XMLHttpRequest();
        xhr.open("GET", `../assets/data/post-${slug}.json`, false); // false = synchronous
        xhr.send(null);

        if (xhr.status === 200) {
          try {
            const post = JSON.parse(xhr.responseText);
            
            // Update title
            document.title = post.title;
            
            // Update meta tags
            const ogImageUrl = post.thumbnail.src.startsWith("http")
              ? post.thumbnail.src
              : new URL(post.thumbnail.src, window.location.origin).href;
            
            const updateMetaTag = (property, content) => {
              let meta = document.querySelector(`meta[property="${property}"]`);
              if (!meta) {
                meta = document.createElement("meta");
                meta.setAttribute("property", property);
                document.head.appendChild(meta);
              }
              meta.setAttribute("content", content);
            };

            updateMetaTag("og:title", post.title);
            updateMetaTag("og:description", post.subtitle);
            updateMetaTag("og:image", ogImageUrl);
            updateMetaTag("og:type", "article");
            updateMetaTag("og:url", window.location.href);
          } catch (e) {
            console.error("Error parsing post data:", e);
          }
        }
      })();
    </script>
    <link rel="stylesheet" href="../styles/style.css" />
    <link
      href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- Navbar will be rendered dynamically -->
    <!-- Post content will be rendered dynamically from JSON -->
    <main></main>

    <script src="../scripts/script.js"></script>
    <script src="../scripts/post.js"></script>
  </body>
</html>
